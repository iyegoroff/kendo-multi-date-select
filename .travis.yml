language: node_js

matrix:
  fast_finish: true
  include:
    - env: TEST='minimal'
      node_js: '7'
    - env: TEST='normal'
      node_js: '7'
  allow_failures:
    - env: TEST='normal'

addons:
  sauce_connect:
    username: 'iyegoroff-3'
    no_ssl_bump_domains: all
  jwt:
    secure: >
      ZQzPBoWH72oe/yeys4hlfXXX2U4I9zhKJYuxGDDm8OCs/QkhwHWDn7OBfIHh2ch+z3dxE9XjV8k5w/vjt3RrxCWxxEHh5Z1sy8Vb5OA3gpGQAXzZH
      gx95YsBU9vnDscgOCkPToUrUrAzmfZ4zuCauZuZQOdk77WFr8ilRQ9Sob2G+633GcoXSLOOtlyOBnzbU4zDr/F7Ia/4nzzIcA65V31wCODijmg/vc
      Uf5YYpwg+6+zZNMYWXf4ibYrG5f2RkouaXyb9GkyBN9DmEDzKqVkqlxKN8X4QchYh4pTZcsnqss/jzPInW0U/Wuf7p4Nyh8LeClt6vbFX2CNQwBRV
      2qA2kuDo4a9elu7BcizhZAUKFFXI3VzQjw7CN6L9ygFMoK5a8yp5gW+jDaZf2fJr4Ok/5XVSdYxBbQA5SxZBCd4iqxQnKKPNQZU2aT1rJYz4MOdwN
      m5NCqAMTzBxo8ZDSFyQK999YOna+pYIwvJPbPZ+1HV+ZpTRzB9S9OxTGvJHsUk4xfzqYTD5pwDDnyR/aLmbiJdb+BBLuAjSmV98tHV5cXFEAaoapw
      x2alOgPsHVV+uZuN20OPTYkWxB/O+mw3mN+8XY60WdeSpBosq3faPP69tZeHxkNWjvXXsFnvrxY56E9GzUo8NZH/4I7XA3fI48WCLJb/JvYFRsgPC
      QbyvU=

branches:
  only:
    - master
    - /^v\d+\.\d+\.\d+$/

before_deploy:
  - cp ./dist/kendo-multi-date-select.min.js ./public/kendo-multi-date-select.min.js
  - cp ./node_modules/kendo-multi-calendar/dist/kendo-multi-calendar.min.js ./public/kendo-multi-calendar.min.js

deploy:
  - provider: npm
    email: iegoroff@gmail.com
    api_key:
      secure: >
        B6f0CpXjvJMEH1+2Imq577csu//vuGZAuPsHgnPOHCnQof1zgC2iEAwlzbOkZqH69+FKIn4vHsgiVCSB47s9nKJpJOLKjm5C25ePgp9r3XWzD8p
        bWZqnyiwZnQXLjueIKcVULQ76DxtXkI5iQxmLAZJeCVJz8OXJEItdY6ufVzsPZ4N0x2InQSsbJN9/v8DReAvQV4VBALO+OYyVbiCcxs5elxPcwf
        X4pS7V9YxA1UI+u7f1Tk4DhhxpHOpEky42BM3y+n9B7n8haCZ5Tv2JfXoAsIG4hihZa8f99mvqLOCRC31bV/FPQY6UrqHAWCIs1kzf0PSz997xq
        /Fo9fqwCE78JLjuYP8YMXt/mMOITWr2iZCNg3UrqBLEEFiQF6hZf9ebTQfJoOrYFvgBUi9+KqjwDH1lwrn0ifsXf2nRNH1HKNAek3CFysOJifrO
        SU7quTd0CQU9BVhVpAz1VFITf6K4Si7FdFMcqvBflXZ2y5uFzlxG3blwwHB2CsEeh5VcyvzI9BPofR3TBIxsqynYputqiXHeo7etb+CbGT4MKeM
        nBRX8hiqmtvkjPgrZh38C/k3ghzglqfgYx5wtlr2mVpZ9OKQonedt+xYwZvVJz4q47mJTbrrCG9oPnwW7oAlzimpqZkS23BwrtmSJ690CpVp3/5
        B+iGqRvS7jDbvbX7g=
    skip_cleanup: true
    on:
      tags: true
      condition: $TEST == 'minimal'
  - provider: surge
    project: ./public/
    domain: kendo-multi-date-select.surge.sh  
    skip_cleanup: true
    on:
      tags: true
      condition: $TEST == 'minimal'


before_script:
  npm run build

script:
  - if [[ $TEST == 'minimal' ]]; then npm run lint && npm run test:ci:minimal; fi
  - if [[ $TEST == 'normal' ]]; then npm run test:ci:normal; fi
after_script:
  if [[ $TEST == 'minimal' ]]; then npm run coverage; fi